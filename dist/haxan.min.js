"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Haxan=e()}(void 0,function(){var n,e,t=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),d=(e=Error,t(o,e),o);function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.isHaxanError=!0,t}var r,b=(t(s,r=d),s);function s(){var t=r.call(this)||this;return t.isTimeout=!0,t}var i,m=(t(u,i=d),u);function u(t){var e=i.call(this)||this;return e.isRejection=!0,e.response=t,e}var a,_,p,v,c,w=(t(h,a=d),h);function h(){var t=a.call(this)||this;return t.isAbort=!0,t}(p=_=_||{}).Auto="auto",p.Json="json",p.Text="text",p.Stream="stream",(c=v=v||{}).Get="GET",c.Post="POST",c.Put="PUT",c.Patch="PATCH",c.Delete="DELETE",c.Head="HEAD",c.Options="OPTIONS";var f=Object.freeze({__proto__:null,HaxanError:d,HaxanTimeout:b,HaxanRejection:m,HaxanAbort:w,get ResponseType(){return _},get HTTPMethod(){return v}});var T=function(){return(T=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},l=function(t,i,u,a){return new(u=u||Promise)(function(o,e){function n(t){try{s(a.next(t))}catch(t){e(t)}}function r(t){try{s(a.throw(t))}catch(t){e(t)}}function s(t){var e;t.done?o(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(n,r)}s((a=a.apply(t,i||[])).next())})},g=function(o,n){var r,s,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,s&&(i=2&e[0]?s.return:e[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,e[1])).done)return i;switch(s=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,s=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(i=0<(i=u.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){u.label=e[1];break}if(6===e[0]&&u.label<i[1]){u.label=i[1],i=e;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(e);break}i[2]&&u.ops.pop(),u.trys.pop();continue}e=n.call(o,u)}catch(t){e=[6,t],s=0}finally{r=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},y=(x.prototype.url=function(t){return this._opts.url=t,this},x.prototype.type=function(t){return this._opts.type=t,this},x.prototype.method=function(t){return this._opts.method=t,this},x.prototype.get=function(){return this.method("GET")},x.prototype.head=function(){return this.method("HEAD")},x.prototype.options=function(){return this.method("OPTIONS")},x.prototype.post=function(t){return this._opts.body=t,this.method("POST")},x.prototype.put=function(t){return this._opts.body=t,this.method("PUT")},x.prototype.patch=function(t){return this._opts.body=t,this.method("PATCH")},x.prototype.delete=function(){return this.method("DELETE")},x.prototype.body=function(t){return this._opts.body=t,this},x.prototype.header=function(t,e){return this._opts.headers[t]=e,this},x.prototype.param=function(t,e){return this._opts.query[t]=e,this},x.prototype.timeout=function(t){return this._opts.timeout=t,this},x.prototype.abort=function(t){return this._opts.abortSignal=t,this},x.prototype.normalizedBody=function(){var t=this._opts.body;return null===t?"":JSON.stringify(t)},x.prototype.parseBody=function(o){return l(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=o.headers.get("content-type"))&&e.startsWith("application/json")?[4,o.json()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,o.text()];case 3:return[2,t.sent()]}})})},x.prototype.send=function(){return this.request()},x.prototype.request=function(){return l(this,void 0,void 0,function(){var s,i,u,a,p,c,h,f,l,y=this;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,9,,10]),s=void 0,i="undefined"!=typeof window&&"[object Window]"==={}.toString.call(window),s=i?fetch:require("node-fetch"),u=this._opts.url+"?"+(r=this._opts.query,Object.keys(r).map(function(t){return t+"="+String(r[t])}).join("&")),[4,Promise.race([s(u,{method:this._opts.method,headers:T(T({"Content-Type":"application/json"},this._opts.headers),{"User-Agent":"Haxan 0.0.1"}),body:(n=this._opts.method,[v.Put,v.Post,v.Patch].includes(n.toUpperCase())?this.normalizedBody():void 0),signal:this._opts.abortSignal}),new Promise(function(t,e){return setTimeout(function(){return e(new b)},y._opts.timeout)})])];case 1:if(a=t.sent(),this._opts.rejectOn(a.status))throw new m(a);return(e=a.headers,o={},e.forEach(function(t,e){o[e]=t}),p=o,this._opts.type!==_.Auto)?[3,3]:(h={},[4,this.parseBody(a)]);case 2:return[2,(h.data=t.sent(),h.ok=a.ok,h.status=a.status,h.headers=p,h)];case 3:return this._opts.type!==_.Json?[3,5]:(f={},[4,a.json()]);case 4:return[2,(f.data=t.sent(),f.ok=a.ok,f.status=a.status,f.headers=p,f)];case 5:return this._opts.type!==_.Text?[3,7]:(l={},[4,a.text()]);case 6:return[2,(l.data=t.sent(),l.ok=a.ok,l.status=a.status,l.headers=p,l)];case 7:if(this._opts.type===_.Stream&&!i)return[2,{data:a.body,ok:a.ok,status:a.status,headers:p}];t.label=8;case 8:throw new Error("No valid response body parsing method found");case 9:if((c=t.sent()).isHaxanError)throw c;if("AbortError"===c.name)throw new w;throw new d(c.message);case 10:return[2]}var e,o,n,r})})},x);function x(t,e){this._opts={url:"",headers:{},query:{},method:v.Get,body:void 0,type:_.Auto,rejectOn:function(){return!1},abortSignal:void 0,timeout:3e4},e&&Object.assign(this._opts,e),this._opts.url=t}function O(t,e){return new y(t,e)}return function(){var t,e=O;for(t in f)e[t]=f[t];return e.HaxanFactory=y,e}()});
